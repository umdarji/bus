<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Routes - Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../styles.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block admin-sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h4 class="text-white">
                            <i class="fas fa-bus me-2"></i>BusGo Admin
                        </h4>
                        <small class="text-muted">Administration Panel</small>
                    </div>
                    
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="dashboard.html">
                                <i class="fas fa-tachometer-alt"></i>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="buses.html">
                                <i class="fas fa-bus"></i>
                                Manage Buses
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="routes.html">
                                <i class="fas fa-route"></i>
                                Manage Routes
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="bookings.html">
                                <i class="fas fa-ticket-alt"></i>
                                Booking Reports
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="cancellations.html">
                                <i class="fas fa-times-circle"></i>
                                Cancellation Management
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="users.html">
                                <i class="fas fa-users"></i>
                                Manage Users
                            </a>
                        </li>
                        <li class="nav-item mt-3">
                            <a class="nav-link" href="../index.html">
                                <i class="fas fa-home"></i>
                                Back to Website
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i>
                                Logout
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Manage Routes</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <button type="button" class="btn btn-primary" onclick="showAddRouteModal()">
                            <i class="fas fa-plus me-2"></i>Add New Route
                        </button>
                    </div>
                </div>

                <!-- Routes Table -->
                <div class="card shadow">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-list me-2"></i>All Routes
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover table-custom">
                                <thead>
                                    <tr>
                                        <th>Route ID</th>
                                        <th>From</th>
                                        <th>To</th>
                                        <th>Distance</th>
                                        <th>Duration</th>
                                        <th>Base Price</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="routesTableBody">
                                    <!-- Routes will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Add/Edit Route Modal -->
    <div class="modal fade" id="routeModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="routeModalTitle">
                        <i class="fas fa-route me-2"></i>Add New Route
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="routeForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="from" class="form-label">From</label>
                                    <select class="form-select" id="from" required>
                                        <option value="">Select departure city</option>
                                        <option value="New York">New York</option>
                                        <option value="Los Angeles">Los Angeles</option>
                                        <option value="Chicago">Chicago</option>
                                        <option value="Houston">Houston</option>
                                        <option value="Phoenix">Phoenix</option>
                                        <option value="Philadelphia">Philadelphia</option>
                                        <option value="San Antonio">San Antonio</option>
                                        <option value="San Diego">San Diego</option>
                                        <option value="Dallas">Dallas</option>
                                        <option value="San Jose">San Jose</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="to" class="form-label">To</label>
                                    <select class="form-select" id="to" required>
                                        <option value="">Select destination city</option>
                                        <option value="New York">New York</option>
                                        <option value="Los Angeles">Los Angeles</option>
                                        <option value="Chicago">Chicago</option>
                                        <option value="Houston">Houston</option>
                                        <option value="Phoenix">Phoenix</option>
                                        <option value="Philadelphia">Philadelphia</option>
                                        <option value="San Antonio">San Antonio</option>
                                        <option value="San Diego">San Diego</option>
                                        <option value="Dallas">Dallas</option>
                                        <option value="San Jose">San Jose</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="distance" class="form-label">Distance (miles)</label>
                                    <input type="number" class="form-control" id="distance" min="1" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="duration" class="form-label">Duration (hours)</label>
                                    <input type="number" class="form-control" id="duration" min="1" step="0.5" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="basePrice" class="form-label">Base Price ($)</label>
                                    <input type="number" class="form-control" id="basePrice" min="1" step="0.01" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="routeStatus" class="form-label">Status</label>
                                    <select class="form-select" id="routeStatus" required>
                                        <option value="active">Active</option>
                                        <option value="inactive">Inactive</option>
                                        <option value="maintenance">Maintenance</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" rows="3" placeholder="Route description..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveRoute()">Save Route</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle me-2"></i>Confirm Delete
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this route?</p>
                    <div id="deleteRouteDetails">
                        <!-- Route details will be shown here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="confirmDeleteRoute()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../script.js"></script>
    <script>
        let routes = [];
        let editingRouteId = null;
        let deletingRouteId = null;
        
        // Sample routes data
        const sampleRoutes = [
            {
                id: 1,
                from: "New York",
                to: "Los Angeles",
                distance: 2789,
                duration: 12,
                basePrice: 120,
                status: "active",
                description: "Cross-country route from NYC to LA"
            },
            {
                id: 2,
                from: "Chicago",
                to: "Houston",
                distance: 940,
                duration: 8,
                basePrice: 85,
                status: "active",
                description: "Midwest to Texas route"
            },
            {
                id: 3,
                from: "Los Angeles",
                to: "Phoenix",
                distance: 372,
                duration: 5,
                basePrice: 65,
                status: "active",
                description: "West coast route"
            }
        ];
        
        // Check admin authentication
        function checkAdminAuth() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser || currentUser.role !== 'admin') {
                alert('Access denied. Admin privileges required.');
                window.location.href = '../login.html';
                return false;
            }
            return true;
        }
        
        // Load routes
        function loadRoutes() {
            if (!checkAdminAuth()) return;
            
            // Initialize routes if not exists
            if (!localStorage.getItem('routes')) {
                localStorage.setItem('routes', JSON.stringify(sampleRoutes));
            }
            
            routes = JSON.parse(localStorage.getItem('routes') || '[]');
            displayRoutes();
        }
        
        // Display routes in table
        function displayRoutes() {
            const tableBody = document.getElementById('routesTableBody');
            let html = '';
            
            if (routes.length === 0) {
                html = '<tr><td colspan="8" class="text-center text-muted">No routes found</td></tr>';
            } else {
                routes.forEach(route => {
                    const statusClass = route.status === 'active' ? 'status-running' : 
                                     route.status === 'inactive' ? 'status-cancelled' : 'status-scheduled';
                    
                    html += `
                        <tr>
                            <td><strong>#${route.id}</strong></td>
                            <td><strong>${route.from}</strong></td>
                            <td><strong>${route.to}</strong></td>
                            <td>${route.distance} miles</td>
                            <td>${route.duration} hours</td>
                            <td>$${route.basePrice}</td>
                            <td><span class="badge ${statusClass}">${route.status.toUpperCase()}</span></td>
                            <td>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-sm btn-outline-primary" onclick="editRoute(${route.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="showDeleteModal(${route.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
            }
            
            tableBody.innerHTML = html;
        }
        
        // Show add route modal
        function showAddRouteModal() {
            editingRouteId = null;
            document.getElementById('routeModalTitle').innerHTML = '<i class="fas fa-route me-2"></i>Add New Route';
            document.getElementById('routeForm').reset();
            
            const modal = new bootstrap.Modal(document.getElementById('routeModal'));
            modal.show();
        }
        
        // Edit route
        function editRoute(routeId) {
            const route = routes.find(r => r.id === routeId);
            if (!route) return;
            
            editingRouteId = routeId;
            document.getElementById('routeModalTitle').innerHTML = '<i class="fas fa-edit me-2"></i>Edit Route';
            
            // Fill form with route data
            document.getElementById('from').value = route.from;
            document.getElementById('to').value = route.to;
            document.getElementById('distance').value = route.distance;
            document.getElementById('duration').value = route.duration;
            document.getElementById('basePrice').value = route.basePrice;
            document.getElementById('routeStatus').value = route.status;
            document.getElementById('description').value = route.description || '';
            
            const modal = new bootstrap.Modal(document.getElementById('routeModal'));
            modal.show();
        }
        
        // Save route
        function saveRoute() {
            const form = document.getElementById('routeForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const routeData = {
                from: document.getElementById('from').value,
                to: document.getElementById('to').value,
                distance: parseInt(document.getElementById('distance').value),
                duration: parseFloat(document.getElementById('duration').value),
                basePrice: parseFloat(document.getElementById('basePrice').value),
                status: document.getElementById('routeStatus').value,
                description: document.getElementById('description').value
            };
            
            if (routeData.from === routeData.to) {
                alert('Departure and destination cannot be the same');
                return;
            }
            
            if (editingRouteId) {
                // Update existing route
                const routeIndex = routes.findIndex(r => r.id === editingRouteId);
                if (routeIndex !== -1) {
                    routes[routeIndex] = {
                        ...routes[routeIndex],
                        ...routeData
                    };
                }
            } else {
                // Add new route
                const newRoute = {
                    id: Date.now(),
                    ...routeData
                };
                routes.push(newRoute);
            }
            
            // Save to localStorage
            localStorage.setItem('routes', JSON.stringify(routes));
            
            // Close modal and refresh
            const modal = bootstrap.Modal.getInstance(document.getElementById('routeModal'));
            modal.hide();
            
            loadRoutes();
            alert(editingRouteId ? 'Route updated successfully!' : 'Route added successfully!');
        }
        
        // Show delete modal
        function showDeleteModal(routeId) {
            const route = routes.find(r => r.id === routeId);
            if (!route) return;
            
            deletingRouteId = routeId;
            const detailsContainer = document.getElementById('deleteRouteDetails');
            detailsContainer.innerHTML = `
                <div class="alert alert-warning">
                    <strong>${route.from} → ${route.to}</strong><br>
                    Distance: ${route.distance} miles<br>
                    Duration: ${route.duration} hours<br>
                    Base Price: $${route.basePrice}
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
            modal.show();
        }
        
        // Confirm delete route
        function confirmDeleteRoute() {
            if (!deletingRouteId) return;
            
            // Check if route has buses
            const buses = JSON.parse(localStorage.getItem('buses') || '[]');
            const routeBuses = buses.filter(bus => {
                const route = routes.find(r => r.id === deletingRouteId);
                return route && bus.from === route.from && bus.to === route.to;
            });
            
            if (routeBuses.length > 0) {
                alert('Cannot delete route with existing buses. Please remove all buses from this route first.');
                const modal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
                modal.hide();
                return;
            }
            
            // Remove route
            routes = routes.filter(route => route.id !== deletingRouteId);
            localStorage.setItem('routes', JSON.stringify(routes));
            
            // Close modal and refresh
            const modal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
            modal.hide();
            
            loadRoutes();
            alert('Route deleted successfully!');
        }
        
        // Logout function
        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = '../login.html';
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadRoutes();
        });
    </script>
</body>
</html> 